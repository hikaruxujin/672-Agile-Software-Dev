function method(b,a){return function(){return b[a].apply(b,arguments)}}var StopIteration={toString:function(){return"StopIteration"}};function forEach(a,c){if(a.next){try{while(true){c(a.next())}}catch(d){if(d!=StopIteration){throw d}}}else{for(var b=0;b<a.length;b++){c(a[b])}}}function map(a,c){var b=[];forEach(a,function(d){b.push(c(d))});return b}function matcher(a){return function(b){return a.test(b)}}function hasClass(b,c){var a=b.className;return a&&new RegExp("(^| )"+c+"($| )").test(a)}function insertAfter(a,c){var b=c.parentNode;b.insertBefore(a,c.nextSibling);return a}function removeElement(a){if(a&&a.parentNode){a.parentNode.removeChild(a)}}function clearElement(a){while(a.firstChild){a.removeChild(a.firstChild)}}function isAncestor(a,b){while(b=b.parentNode){if(a==b){return true}}return false}var nbsp="\u00a0";var matching={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("};function normalizeEvent(a){if(!a.stopPropagation){a.stopPropagation=function(){this.cancelBubble=true};a.preventDefault=function(){this.returnValue=false}}if(!a.stop){a.stop=function(){this.stopPropagation();this.preventDefault()}}if(a.type=="keypress"){a.code=(a.charCode==null)?a.keyCode:a.charCode;a.character=String.fromCharCode(a.code)}return a}function addEventHandler(c,b,a,e){function d(f){a(normalizeEvent(f||window.event))}if(typeof c.addEventListener=="function"){c.addEventListener(b,d,false);if(e){return function(){c.removeEventListener(b,d,false)}}}else{c.attachEvent("on"+b,d);if(e){return function(){c.detachEvent("on"+b,d)}}}}function nodeText(a){return a.textContent||a.innerText||a.nodeValue||""}function nodeTop(a){var b=0;while(a.offsetParent){b+=a.offsetTop;a=a.offsetParent}return b}function isBR(a){var b=a.nodeName;return b=="BR"||b=="br"}function isSpan(a){var b=a.nodeName;return b=="SPAN"||b=="span"||b=="B"||b=="b"}var stringStream=function(c){var d="";var e=0;var b="";function a(){while(e==d.length){b+=d;d="";e=0;try{d=c.next()}catch(f){if(f!=StopIteration){throw f}else{return false}}}return true}return{peek:function(){if(!a()){return null}return d.charAt(e)},next:function(){if(!a()){if(b.length>0){throw"End of stringstream reached without emptying buffer ('"+b+"')."}else{throw StopIteration}}return d.charAt(e++)},get:function(){var f=b;b="";if(e>0){f+=d.slice(0,e);d=d.slice(e);e=0}return f},push:function(f){d=d.slice(0,e)+f+d.slice(e)},lookAhead:function(m,h,i,j){function l(q){return j?q.toLowerCase():q}m=l(m);var p=false;var o=b,n=e;if(i){this.nextWhileMatches(/[\s\u00a0]/)}while(true){var g=e+m.length,f=d.length-e;if(g<=d.length){p=m==l(d.slice(e,g));e=g;break}else{if(m.slice(0,f)==l(d.slice(e))){b+=d;d="";try{d=c.next()}catch(k){break}e=0;m=m.slice(f)}else{break}}}if(!(p&&h)){d=b.slice(o.length)+d;e=n;b=o}return p},more:function(){return this.peek()!==null},applies:function(g){var f=this.peek();return(f!==null&&g(f))},nextWhile:function(g){var f;while((f=this.peek())!==null&&g(f)){this.next()}},matches:function(g){var f=this.peek();return(f!==null&&g.test(f))},nextWhileMatches:function(g){var f;while((f=this.peek())!==null&&g.test(f)){this.next()}},equals:function(f){return f===this.peek()},endOfLine:function(){var f=this.peek();return f==null||f=="\n"}}};var select={};(function(){select.ie_selection=document.selection&&document.selection.createRangeCollection;function e(k,l){while(k&&k.parentNode!=l){k=k.parentNode}return k}function j(k,l){while(!k.previousSibling&&k.parentNode!=l){k=k.parentNode}return e(k.previousSibling,l)}var f="\u00a0\u00a0\u00a0\u00a0";select.scrollToNode=function(E,m){if(!E){return}var l=E,G=l.ownerDocument,s=G.body,n=(G.defaultView||G.parentWindow),t=G.documentElement,A=!l.nextSibling||!l.nextSibling.nextSibling||!l.nextSibling.nextSibling.nextSibling;var p=0;while(l&&!l.offsetTop){p++;l=l.previousSibling}if(p==0){A=false}if(webkit&&l&&l.offsetTop==5&&l.offsetLeft==5){return}var q=p*(l?l.offsetHeight:0),r=0,D=(E?E.offsetWidth:0),o=l;while(o&&o.offsetParent){q+=o.offsetTop;if(!isBR(o)){r+=o.offsetLeft}o=o.offsetParent}var C=s.scrollLeft||t.scrollLeft||0,B=s.scrollTop||t.scrollTop||0,k=false,z=n.innerWidth||t.clientWidth||0;if(m||D<z){if(m){var F=select.offsetInNode(n,E),w=nodeText(E).length;if(w){r+=D*(F/w)}}var v=r-C;if(v<0||v>z){C=r;k=true}}var u=q-B;if(u<0||A||u>(n.innerHeight||t.clientHeight||0)-50){B=A?1000000:q;k=true}if(k){n.scrollTo(C,B)}};select.scrollToCursor=function(k){select.scrollToNode(select.selectionTopNode(k,true)||k.firstChild,true)};var c=null;select.snapshotChanged=function(){if(c){c.changed=true}};select.snapshotReplaceNode=function(o,n,l,m){if(!c){return}function k(p){if(o==p.node){c.changed=true;if(l&&p.offset>l){p.offset-=l}else{p.node=n;p.offset+=(m||0)}}}k(c.start);k(c.end)};select.snapshotMove=function(p,o,n,l,m){if(!c){return}function k(q){if(p==q.node&&(!m||q.offset==0)){c.changed=true;q.node=o;if(l){q.offset=Math.max(0,q.offset+n)}else{q.offset=n}}}k(c.start);k(c.end)};if(select.ie_selection){function g(o,k){var n=o.document.selection.createRange();n.collapse(k);function p(u){var v=null;while(!v&&u){v=u.nextSibling;u=u.parentNode}return m(v)}function m(u){while(u&&u.firstChild){u=u.firstChild}return{node:u,offset:0}}var t=n.parentElement();if(!isAncestor(o.document.body,t)){return null}if(!t.firstChild){return m(t)}var q=n.duplicate();q.moveToElementText(t);q.collapse(true);for(var r=t.firstChild;r;r=r.nextSibling){if(r.nodeType==3){var s=r.nodeValue.length;q.move("character",s)}else{q.moveToElementText(r);q.collapse(false)}var l=n.compareEndPoints("StartToStart",q);if(l==0){return p(r)}if(l==1){continue}if(r.nodeType!=3){return m(r)}q.setEndPoint("StartToEnd",n);return{node:r,offset:s-q.text.length}}return p(t)}select.markSelection=function(m){c=null;var l=m.document.selection;if(!l){return}var n=g(m,true),k=g(m,false);if(!n||!k){return}c={start:n,end:k,window:m,changed:false}};select.selectMarked=function(){if(!c||!c.changed){return}var n=c.window,m=n.document;function l(p){var q=m.body.createTextRange(),r=p.node;if(!r){q.moveToElementText(c.window.document.body);q.collapse(false)}else{if(r.nodeType==3){q.moveToElementText(r.parentNode);var s=p.offset;while(r.previousSibling){r=r.previousSibling;s+=(r.innerText||"").length}q.move("character",s)}else{q.moveToElementText(r);q.collapse(true)}}return q}var o=l(c.start),k=l(c.end);o.setEndPoint("StartToEnd",k);o.select()};select.offsetInNode=function(p,m){var n=p.document.selection;if(!n){return 0}var l=n.createRange(),k=l.duplicate();try{k.moveToElementText(m)}catch(o){return 0}l.setEndPoint("StartToStart",k);return l.text.length};select.selectionTopNode=function(k,l){var r=k.ownerDocument.selection;if(!r){return false}var p=r.createRange(),s=p.duplicate();p.collapse(l);var q=p.parentElement();if(q&&isAncestor(k,q)){s.moveToElementText(q);if(p.compareEndPoints("StartToStart",s)==1){return e(q,k)}}function n(u,w){if(w.nodeType==3){var v=0,y=w.previousSibling;while(y&&y.nodeType==3){v+=y.nodeValue.length;y=y.previousSibling}if(y){try{u.moveToElementText(y)}catch(x){return false}u.collapse(false)}else{u.moveToElementText(w.parentNode)}if(v){u.move("character",v)}}else{try{u.moveToElementText(w)}catch(x){return false}}return true}var l=0,o=k.childNodes.length-1;while(l<o){var t=Math.ceil((o+l)/2),m=k.childNodes[t];if(!m){return false}if(!n(s,m)){return false}if(p.compareEndPoints("StartToStart",s)==1){l=t}else{o=t-1}}return k.childNodes[l]||null};select.focusAfterNode=function(m,k){this.scrollToNode(m);var l=k.ownerDocument.body.createTextRange();l.moveToElementText(m||k);l.collapse(!m);l.select()};select.somethingSelected=function(l){var k=l.document.selection;return k&&(k.createRange().text!="")};function b(n,l){var m=n.document.selection;if(m){var k=m.createRange();k.pasteHTML(l);k.collapse(false);k.select()}}select.insertNewlineAtCursor=function(k){b(k,"<br>")};select.insertTabAtCursor=function(k){b(k,f)};select.cursorPos=function(l,q){var o=l.ownerDocument.selection;if(!o){return null}var n=select.selectionTopNode(l,q);while(n&&!isBR(n)){n=n.previousSibling}var m=o.createRange(),k=m.duplicate();m.collapse(q);if(n){k.moveToElementText(n);k.collapse(false)}else{try{k.moveToElementText(l)}catch(p){return null}k.collapse(true)}m.setEndPoint("StartToStart",k);return{node:n,offset:m.text.length}};select.setCursorPos=function(l,o,n){function k(q){var p=l.ownerDocument.body.createTextRange();if(!q.node){p.moveToElementText(l);p.collapse(true)}else{p.moveToElementText(q.node);p.collapse(false)}p.move("character",q.offset);return p}var m=k(o);if(n&&n!=o){m.setEndPoint("EndToEnd",k(n))}m.select()};select.getBookmark=function(k){var m=select.cursorPos(k,true),l=select.cursorPos(k,false);if(m&&l){return{from:m,to:l}}};select.setBookmark=function(k,l){if(!l){return}select.setCursorPos(k,l.from,l.to)}}else{function i(l,m){while(l.nodeType!=3&&!isBR(l)){var k=l.childNodes[m]||l.nextSibling;m=0;while(!k&&l.parentNode){l=l.parentNode;k=l.nextSibling}l=k;if(!k){break}}return{node:l,offset:m}}select.markSelection=function(m){var l=m.getSelection();if(!l||l.rangeCount==0){return(c=null)}var k=l.getRangeAt(0);c={start:i(k.startContainer,k.startOffset),end:i(k.endContainer,k.endOffset),window:m,changed:false}};select.selectMarked=function(){var m=c;function o(){if(m.start.node==m.end.node&&m.start.offset==m.end.offset){var r=m.window.getSelection();if(!r||r.rangeCount==0){return true}var q=r.getRangeAt(0),p=i(q.startContainer,q.startOffset);return m.start.node!=p.node||m.start.offset!=p.offset}}if(!m||!(m.changed||(webkit&&o()))){return}var n=m.window,l=n.document.createRange();function k(p,q){if(p.node){if(p.offset==0){l["set"+q+"Before"](p.node)}else{l["set"+q](p.node,p.offset)}}else{l.setStartAfter(n.document.body.lastChild||n.document.body)}}k(m.end,"End");k(m.start,"Start");h(l,n)};function h(k,m){var l=m.getSelection();if(!l){return}l.removeAllRanges();l.addRange(k)}function a(l){var k=l.getSelection();if(!k||k.rangeCount==0){return false}else{return k.getRangeAt(0)}}select.selectionTopNode=function(k,o){var l=a(k.ownerDocument.defaultView);if(!l){return false}var m=o?l.startContainer:l.endContainer;var n=o?l.startOffset:l.endOffset;if(window.opera&&!o&&l.endContainer==k&&l.endOffset==l.startOffset+1&&k.childNodes[l.startOffset]&&isBR(k.childNodes[l.startOffset])){n--}if(m.nodeType==3){if(n>0){return e(m,k)}else{return j(m,k)}}else{if(m.nodeName.toUpperCase()=="HTML"){return(n==1?null:k.lastChild)}else{if(m==k){return(n==0)?null:m.childNodes[n-1]}else{if(n==m.childNodes.length){return e(m,k)}else{if(n==0){return j(m,k)}else{return e(m.childNodes[n-1],k)}}}}}};select.focusAfterNode=function(m,k){var n=k.ownerDocument.defaultView,l=n.document.createRange();this.scrollToNode(m);l.setStartBefore(k.firstChild||k);if(m&&!m.firstChild){l.setEndAfter(m)}else{if(m){l.setEnd(m,m.childNodes.length)}else{l.setEndBefore(k.firstChild||k)}}l.collapse(false);h(l,n)};select.somethingSelected=function(l){var k=a(l);return k&&!k.collapsed};select.offsetInNode=function(m,l){var k=a(m);if(!k){return 0}k=k.cloneRange();k.setStartBefore(l);return k.toString().length};function d(q,o){var l=a(q);if(!l){return}l.deleteContents();l.insertNode(o);if(q.opera&&isBR(o)&&isSpan(o.parentNode)){var n=o.nextSibling,r=o.parentNode,m=r.parentNode;m.insertBefore(o,r.nextSibling);var k="";for(;n&&n.nodeType==3;n=n.nextSibling){k+=n.nodeValue;removeElement(n)}m.insertBefore(makePartSpan(k,q.document),o.nextSibling)}l=q.document.createRange();l.selectNode(o);l.collapse(false);h(l,q)}select.insertNewlineAtCursor=function(k){if(webkit){document.execCommand("insertLineBreak")}else{d(k,k.document.createElement("BR"))}};select.insertTabAtCursor=function(k){d(k,k.document.createTextNode(f))};select.cursorPos=function(k,n){var l=a(window);if(!l){return}var m=select.selectionTopNode(k,n);while(m&&!isBR(m)){m=m.previousSibling}l=l.cloneRange();l.collapse(n);if(m){l.setStartAfter(m)}else{l.setStartBefore(k)}return{node:m,offset:l.toString().length}};select.setCursorPos=function(k,p,o){var n=k.ownerDocument.defaultView,m=n.document.createRange();function l(t,w,r){if(w==0&&t&&!t.nextSibling){m["set"+r+"After"](t);return true}if(!t){t=k.firstChild}else{t=t.nextSibling}if(!t){return}if(w==0){m["set"+r+"Before"](t);return true}var u=[];function q(x){if(x.nodeType==3){u.push(x)}else{forEach(x.childNodes,q)}}while(true){while(t&&!u.length){q(t);t=t.nextSibling}var v=u.shift();if(!v){return false}var s=v.nodeValue.length;if(s>=w){m["set"+r](v,w);return true}w-=s}}o=o||p;if(l(o.node,o.offset,"End")&&l(p.node,p.offset,"Start")){h(m,n)}}}})();function UndoHistory(b,e,a,d){this.container=b;this.maxDepth=e;this.commitDelay=a;this.editor=d;this.parent=d.parent;var c={text:"",from:null,to:null};this.first=c;this.last=c;this.firstTouched=false;this.history=[];this.redoHistory=[];this.touched=[]}UndoHistory.prototype={scheduleCommit:function(){var a=this;this.parent.clearTimeout(this.commitTimeout);this.commitTimeout=this.parent.setTimeout(function(){a.tryCommit()},this.commitDelay)},touch:function(a){this.setTouched(a);this.scheduleCommit()},undo:function(){this.commit();if(this.history.length){var a=this.history.pop();this.redoHistory.push(this.updateTo(a,"applyChain"));this.notifyEnvironment();return this.chainNode(a)}},redo:function(){this.commit();if(this.redoHistory.length){var a=this.redoHistory.pop();this.addUndoLevel(this.updateTo(a,"applyChain"));this.notifyEnvironment();return this.chainNode(a)}},clear:function(){this.history=[];this.redoHistory=[]},historySize:function(){return{undo:this.history.length,redo:this.redoHistory.length}},push:function(f,e,b){var d=[];for(var c=0;c<b.length;c++){var a=(c==b.length-1)?e:this.container.ownerDocument.createElement("BR");d.push({from:f,to:a,text:cleanText(b[c])});f=a}this.pushChains([d],f==null&&e==null);this.notifyEnvironment()},pushChains:function(b,a){this.commit(a);this.addUndoLevel(this.updateTo(b,"applyChain"));this.redoHistory=[]},chainNode:function(c){for(var a=0;a<c.length;a++){var d=c[a][0],b=d&&(d.from||d.to);if(b){return b}}},reset:function(){this.history=[];this.redoHistory=[]},textAfter:function(a){return this.after(a).text},nodeAfter:function(a){return this.after(a).to},nodeBefore:function(a){return this.before(a).from},tryCommit:function(){if(!window.UndoHistory){return}if(this.editor.highlightDirty()){this.commit(true)}else{this.scheduleCommit()}},commit:function(b){this.parent.clearTimeout(this.commitTimeout);if(!b){this.editor.highlightDirty(true)}var c=this.touchedChains(),a=this;if(c.length){this.addUndoLevel(this.updateTo(c,"linkChain"));this.redoHistory=[];this.notifyEnvironment()}},updateTo:function(e,a){var d=[],c=[];for(var b=0;b<e.length;b++){d.push(this.shadowChain(e[b]));c.push(this[a](e[b]))}if(a=="applyChain"){this.notifyDirty(c)}return d},notifyDirty:function(a){forEach(a,method(this.editor,"addDirtyNode"));this.editor.scheduleHighlight()},notifyEnvironment:function(){if(this.onChange){this.onChange()}if(window.frameElement&&window.frameElement.CodeMirror.updateNumbers){window.frameElement.CodeMirror.updateNumbers()}},linkChain:function(c){for(var b=0;b<c.length;b++){var a=c[b];if(a.from){a.from.historyAfter=a}else{this.first=a}if(a.to){a.to.historyBefore=a}else{this.last=a}}},after:function(a){return a?a.historyAfter:this.first},before:function(a){return a?a.historyBefore:this.last},setTouched:function(a){if(a){if(!a.historyTouched){this.touched.push(a);a.historyTouched=true}}else{this.firstTouched=true}},addUndoLevel:function(a){this.history.push(a);if(this.history.length>this.maxDepth){this.history.shift()}},touchedChains:function(){var c=this;var d=null;function b(i){return i?i.historyTemp:d}function f(j,i){if(j){j.historyTemp=i}else{d=i}}function e(i){var k=[];for(var j=i?i.nextSibling:c.container.firstChild;j&&!isBR(j);j=j.nextSibling){if(j.currentText){k.push(j.currentText)}}return{from:i,to:j,text:cleanText(k.join(""))}}var a=[];if(c.firstTouched){c.touched.push(null)}forEach(c.touched,function(j){if(j&&j.parentNode!=c.container){return}if(j){j.historyTouched=false}else{c.firstTouched=false}var i=e(j),k=c.after(j);if(!k||k.text!=i.text||k.to!=i.to){a.push(i);f(j,i)}});function h(l,i){var k=i+"Sibling",j=l[k];while(j&&!isBR(j)){j=j[k]}return j}var g=[];c.touched=[];forEach(a,function(j){if(!b(j.from)){return}var k=[],l=j.from,m=true;while(true){var i=b(l);if(!i){if(m){break}else{i=e(l)}}k.unshift(i);f(l,null);if(!l){break}m=c.after(l);l=h(l,"previous")}l=j.to;m=c.before(j.from);while(true){if(!l){break}var i=b(l);if(!i){if(m){break}else{i=e(l)}}k.push(i);f(l,null);m=c.before(l);l=h(l,"next")}g.push(k)});return g},shadowChain:function(c){var e=[],d=this.after(c[0].from),b=c[c.length-1].to;while(true){e.push(d);var a=d.to;if(!a||a==b){break}else{d=a.historyAfter||this.before(b)}}return e},applyChain:function(a){var k=select.cursorPos(this.container,false),l=this;function b(p,o){var n=p?p.nextSibling:l.container.firstChild;while(n!=o){var i=n.nextSibling;removeElement(n);n=i}}var c=a[0].from,g=a[a.length-1].to;b(c,g);for(var h=0;h<a.length;h++){var m=a[h];if(h>0){l.container.insertBefore(m.from,g)}var d=makePartSpan(fixSpaces(m.text),this.container.ownerDocument);l.container.insertBefore(d,g);if(k&&k.node==m.from){var f=0;var e=this.after(m.from);if(e&&h==a.length-1){for(var j=0;j<k.offset&&m.text.charAt(j)==e.text.charAt(j);j++){}if(k.offset>j){f=m.text.length-e.text.length}}select.setCursorPos(this.container,{node:m.from,offset:Math.max(0,k.offset+f)})}else{if(k&&(h==a.length-1)&&k.node&&k.node.parentNode!=this.container){select.setCursorPos(this.container,{node:m.from,offset:m.text.length})}}}this.linkChain(a);return c}};var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);var webkit=/AppleWebKit/.test(navigator.userAgent);var safari=/Apple Computers, Inc/.test(navigator.vendor);var gecko=/gecko\/(\d{8})/i.test(navigator.userAgent);var brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent);function makeWhiteSpace(c){var b=[],a=true;for(;c>0;c--){b.push((a||c==1)?nbsp:" ");a^=true}return b.join("")}function fixSpaces(a){if(a.charAt(0)==" "){a=nbsp+a.slice(1)}return a.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(b){return makeWhiteSpace(b.length)})}function cleanText(a){return a.replace(/\u00a0/g," ")}function makePartSpan(d,e,c){var f=d;if(d.nodeType==3){f=d.nodeValue}else{d=e.createTextNode(f)}var a=Editor.Parser.scopeChars,g=a&&c&&a.indexOf(c)!=-1;var b=e.createElement(g?"B":"SPAN");b.isPart=true;b.appendChild(d);b.currentText=f;return b}var Editor=(function(){var g={P:true,DIV:true,LI:true};function b(l){var m=makeWhiteSpace(indentUnit);return map(l.replace(/\t/g,m).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function d(n,m){var p=n.ownerDocument;var l=[];var q=true;function o(r,s){if(r.nodeType==3){var t=r.nodeValue=fixSpaces(r.nodeValue.replace(/\r/g,"").replace(/\n/g," "));if(t.length){q=false}l.push(r)}else{if(isBR(r)&&r.childNodes.length==0){q=true;l.push(r)}else{for(var u=r.firstChild;u;u=u.nextSibling){o(u)}if(!q&&g.hasOwnProperty(r.nodeName.toUpperCase())){q=true;if(!m||!s){l.push(p.createElement("BR"))}}}}}o(n,true);return l}function e(l){var m=l.ownerDocument;var n=[];function r(x){var w=x.parentNode;var v=x.nextSibling;return function(y){w.insertBefore(y,v)}}var t=null;var s=true;function o(v){var w="\n";if(v.nodeType==3){select.snapshotChanged();v=makePartSpan(v,m);w=v.currentText;s=false}else{if(s&&window.opera){t(makePartSpan("",m))}s=true}v.dirty=true;n.push(v);t(v);return w}function p(x,v){var y=d(x,v);for(var w=0;w<y.length;w++){y[w]=o(y[w])}return y.join("")}function u(v){if(v.isPart&&v.childNodes.length==1&&v.firstChild.nodeType==3){v.currentText=v.firstChild.nodeValue;return !/[\n\t\r]/.test(v.currentText)}return false}function q(){if(!l){throw StopIteration}var w=l;l=w.nextSibling;if(u(w)){n.push(w);s=false;return w.currentText}else{if(isBR(w)){if(s&&window.opera){w.parentNode.insertBefore(makePartSpan("",m),w)}n.push(w);s=true;return"\n"}else{var v=!w.nextSibling;t=r(w);removeElement(w);return p(w,v)}}}return{next:q,nodes:n}}function h(l){return isBR(l)?1:l.currentText.length}function j(l){while(l&&!isBR(l)){l=l.previousSibling}return l}function k(m,l){if(!m){m=l.firstChild}else{if(isBR(m)){m=m.nextSibling}}while(m&&!isBR(m)){m=m.nextSibling}return m}function c(){return new Date().getTime()}function i(o,m,r,n){this.editor=o;this.history=o.history;this.history.commit();this.valid=!!m;this.atOccurrence=false;if(n==undefined){n=m==m.toLowerCase()}function l(t){var s=cleanText(o.history.textAfter(t));return(n?s.toLowerCase():s)}if(r&&typeof r=="object"&&typeof r.character=="number"){o.checkLine(r.line);var q={node:r.line,offset:r.character};this.pos={from:q,to:q}}else{if(r){this.pos={from:select.cursorPos(o.container,true),to:select.cursorPos(o.container,false)}}else{var q={node:null,offset:0};this.pos={from:q,to:q}}}var p=(this.caseFold?m.toLowerCase():m).split("\n");this.matches=(p.length==1)?function(v,w,x){var t=l(w),s=m.length,u;if(v?(x>=s&&(u=t.lastIndexOf(m,x-s))!=-1):(u=t.indexOf(m,x))!=-1){return{from:{node:w,offset:u},to:{node:w,offset:u+s}}}}:function(x,s,t){var z=(x?p.length-1:0),v=p[z],A=l(s);var w=(x?A.indexOf(v)+v.length:A.lastIndexOf(v));if(x?w>=t||w!=v.length:w<=t||w!=A.length-v.length){return}var y=s;while(true){if(x&&!y){return}y=(x?this.history.nodeBefore(y):this.history.nodeAfter(y));if(!x&&!y){return}A=l(y);v=p[x?--z:++z];if(z>0&&z<p.length-1){if(A!=v){return}else{continue}}var u=(x?A.lastIndexOf(v):A.indexOf(v)+v.length);if(x?u!=A.length-v.length:u!=v.length){return}return{from:{node:x?y:s,offset:x?u:w},to:{node:x?s:y,offset:x?w:u}}}}}i.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(m){if(!this.valid){return false}var l=this,r=m?this.pos.from:this.pos.to,p=r.node,q=r.offset;if(p&&!p.parentNode){p=null;q=0}function o(){var s={node:p,offset:q};l.pos={from:s,to:s};l.atOccurrence=false;return false}while(true){if(this.pos=this.matches(m,p,q)){this.atOccurrence=true;return true}if(m){if(!p){return o()}p=this.history.nodeBefore(p);q=this.history.textAfter(p).length}else{var n=this.history.nodeAfter(p);if(!n){q=this.history.textAfter(p).length;return o()}p=n;q=0}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.pos.from,this.pos.to);select.scrollToCursor(this.editor.container)}},replace:function(m){if(this.atOccurrence){var l=this.editor.replaceRange(this.pos.from,this.pos.to,m);this.pos.to=l;this.atOccurrence=false}},position:function(){if(this.atOccurrence){return{line:this.pos.from.node,character:this.pos.from.offset}}}};function f(t){this.options=t;window.indentUnit=t.indentUnit;this.parent=parent;this.doc=document;var m=this.container=this.doc.body;this.win=window;this.history=new UndoHistory(m,t.undoDepth,t.undoDelay,this);var s=this;if(!f.Parser){throw"No parser loaded."}if(t.parserConfig&&f.Parser.configure){f.Parser.configure(t.parserConfig)}if(!t.readOnly){select.setCursorPos(m,{node:null,offset:0})}this.dirty=[];m.style.display="none";this.importCode(t.content||"");m.style.display="";this.history.onChange=t.onChange;if(!t.readOnly){if(t.continuousScanning!==false){this.scanner=this.documentScanner(t.passTime);this.delayScanning()}function o(){if(document.body.contentEditable!=undefined&&internetExplorer){document.body.contentEditable="true"}else{document.designMode="on"}if(internetExplorer&&t.height!="dynamic"){document.body.style.minHeight=t.height}document.documentElement.style.borderWidth="0";if(!t.textWrapping){m.style.whiteSpace="nowrap"}}try{o()}catch(p){var q=addEventHandler(document,"focus",function(){q();o()},true)}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));function r(){s.cursorActivity(false)}addEventHandler(document.body,"mouseup",r);addEventHandler(document.body,"cut",r);var l=this.options.onBlur;addEventHandler(document,"blur",function(){if(l){l()}});var n=this.options.onDblclick;addEventHandler(document.body,"dblclick",function(){if(n){var v=select.selectionTopNode(s.container,true),u=select.selectionTopNode(s.container,false);if(v===false||u===false){return}n(v,u)}});if(gecko){addEventHandler(this.win,"pagehide",function(){s.unloaded=true})}addEventHandler(document.body,"paste",function(u){r();var w=null;try{var x=u.clipboardData||window.clipboardData;if(x){w=x.getData("Text")}}catch(v){}if(w!==null){u.stop();s.replaceSelection(w);select.scrollToCursor(s.container)}});if(this.options.autoMatchParens){addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}else{if(!t.textWrapping){m.style.whiteSpace="nowrap"}}}function a(l){return(l>=16&&l<=18)||(l>=33&&l<=40)}f.prototype={importCode:function(l){this.history.push(null,null,b(l));this.history.reset()},getCode:function(){if(!this.container.firstChild){return""}var l=[];select.markSelection(this.win);forEach(e(this.container.firstChild),method(l,"push"));select.selectMarked();return cleanText(l.join(""))},checkLine:function(l){if(l===false||!(l==null||l.parentNode==this.container)){throw parent.CodeMirror.InvalidLineHandle}},cursorPosition:function(m){if(m==null){m=true}var l=select.cursorPos(this.container,m);if(l){return{line:l.node,character:l.offset}}else{return{line:null,character:0}}},firstLine:function(){return null},lastLine:function(){if(this.container.lastChild){return j(this.container.lastChild)}else{return null}},nextLine:function(m){this.checkLine(m);var l=k(m,this.container);return l||false},prevLine:function(l){this.checkLine(l);if(l==null){return false}return j(l.previousSibling)},visibleLineCount:function(){var l=this.container.firstChild;while(l&&isBR(l)){l=l.nextSibling}if(!l){return false}var m=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);return Math.floor(m/l.offsetHeight)},selectLines:function(p,l,o,n){this.checkLine(p);var q={node:p,offset:l},m=null;if(n!==undefined){this.checkLine(o);m={node:o,offset:n}}select.setCursorPos(this.container,q,m);select.scrollToCursor(this.container)},lineContent:function(l){var m=[];for(l=l?l.nextSibling:this.container.firstChild;l&&!isBR(l);l=l.nextSibling){m.push(nodeText(l))}return cleanText(m.join(""))},setLineContent:function(l,m){this.history.commit();this.replaceRange({node:l,offset:0},{node:l,offset:this.history.textAfter(l).length},m);this.addDirtyNode(l);this.scheduleHighlight()},removeLine:function(l){var n=l?l.nextSibling:this.container.firstChild;while(n){var m=n.nextSibling;removeElement(n);if(isBR(n)){break}n=m}this.addDirtyNode(l);this.scheduleHighlight()},insertIntoLine:function(s,m,n){var o=null;if(m=="end"){o=k(s,this.container)}else{for(var q=s?s.nextSibling:this.container.firstChild;q;q=q.nextSibling){if(m==0){o=q;break}var r=nodeText(q);if(r.length>m){o=q.nextSibling;n=r.slice(0,m)+n+r.slice(m);removeElement(q);break}m-=r.length}}var t=b(n),p=this.container.ownerDocument;for(var l=0;l<t.length;l++){if(l>0){this.container.insertBefore(p.createElement("BR"),o)}this.container.insertBefore(makePartSpan(t[l],p),o)}this.addDirtyNode(s);this.scheduleHighlight()},selectedText:function(){var m=this.history;m.commit();var p=select.cursorPos(this.container,true),l=select.cursorPos(this.container,false);if(!p||!l){return""}if(p.node==l.node){return m.textAfter(p.node).slice(p.offset,l.offset)}var n=[m.textAfter(p.node).slice(p.offset)];for(var o=m.nodeAfter(p.node);o!=l.node;o=m.nodeAfter(o)){n.push(m.textAfter(o))}n.push(m.textAfter(l.node).slice(0,l.offset));return cleanText(n.join("\n"))},replaceSelection:function(m){this.history.commit();var n=select.cursorPos(this.container,true),l=select.cursorPos(this.container,false);if(!n||!l){return}l=this.replaceRange(n,l,m);select.setCursorPos(this.container,l)},cursorCoords:function(l){var m=select.cursorPos(this.container,l);if(!m){return null}var n=m.offset,o=m.node,r=this.win.document,t=this;function s(w,v){var z=-(t.win.document.body.scrollTop||t.win.document.documentElement.scrollTop||0),u=-(t.win.document.body.scrollLeft||t.win.document.documentElement.scrollLeft||0)+v;forEach([w,t.win.frameElement],function(x){while(x){u+=x.offsetLeft;z+=x.offsetTop;x=x.offsetParent}});return{x:u,y:z,yBot:z+w.offsetHeight}}function q(w,v){var u=r.createElement("SPAN");u.appendChild(r.createTextNode(w));try{return v(u)}finally{if(u.parentNode){u.parentNode.removeChild(u)}}}while(n){o=o?o.nextSibling:this.container.firstChild;var p=nodeText(o);if(n<p.length){return q(p.substr(0,n),function(u){u.style.position="absolute";u.style.visibility="hidden";u.className=o.className;t.container.appendChild(u);return s(o,u.offsetWidth)})}n-=p.length}if(o&&isSpan(o)){return s(o,o.offsetWidth)}else{if(o&&o.nextSibling&&isSpan(o.nextSibling)){return s(o.nextSibling,0)}else{return q("\u200b",function(u){if(o){o.parentNode.insertBefore(u,o.nextSibling)}else{t.container.insertBefore(u,t.container.firstChild)}return s(u,0)})}}},reroutePasteEvent:function(){if(this.capturingPaste||window.opera){return}this.capturingPaste=true;var m=window.frameElement.CodeMirror.textareaHack;parent.focus();m.value="";m.focus();var l=this;this.parent.setTimeout(function(){l.capturingPaste=false;l.win.focus();if(l.selectionSnapshot){l.win.select.setBookmark(l.container,l.selectionSnapshot)}var n=m.value;if(n){l.replaceSelection(n);select.scrollToCursor(l.container)}},10)},replaceRange:function(q,p,o){var n=b(o);n[0]=this.history.textAfter(q.node).slice(0,q.offset)+n[0];var m=n[n.length-1];n[n.length-1]=m+this.history.textAfter(p.node).slice(p.offset);var l=this.history.nodeAfter(p.node);this.history.push(q.node,l,n);return{node:this.history.nodeBefore(l),offset:m.length}},getSearchCursor:function(m,l,n){return new i(this,m,l,n)},reindent:function(){if(this.container.firstChild){this.indentRegion(null,this.container.lastChild)}},reindentSelection:function(m){if(!select.somethingSelected(this.win)){this.indentAtCursor(m)}else{var n=select.selectionTopNode(this.container,true),l=select.selectionTopNode(this.container,false);if(n===false||l===false){return}this.indentRegion(n,l,m)}},grabKeys:function(l,m){this.frozen=l;this.keyFilter=m},ungrabKeys:function(){this.frozen="leave"},setParser:function(l,m){f.Parser=window[l];m=m||this.options.parserConfig;if(m&&f.Parser.configure){f.Parser.configure(m)}if(this.container.firstChild){forEach(this.container.childNodes,function(o){if(o.nodeType!=3){o.dirty=true}});this.addDirtyNode(this.firstChild);this.scheduleHighlight()}},keyDown:function(n){if(this.frozen=="leave"){this.frozen=null;this.keyFilter=null}if(this.frozen&&(!this.keyFilter||this.keyFilter(n.keyCode,n))){n.stop();this.frozen(n);return false}var m=n.keyCode;this.delayScanning();if(this.options.autoMatchParens){this.scheduleParenHighlight()}if(m==13){if(n.ctrlKey&&!n.altKey){this.reparseBuffer()}else{select.insertNewlineAtCursor(this.win);var p=this.options.enterMode;if(p!="flat"){this.indentAtCursor(p=="keep"?"keep":undefined)}select.scrollToCursor(this.container)}n.stop()}else{if(m==9&&this.options.tabMode!="default"&&!n.ctrlKey){this.handleTab(!n.shiftKey);n.stop()}else{if(m==32&&n.shiftKey&&this.options.tabMode=="default"){this.handleTab(true);n.stop()}else{if(m==36&&!n.shiftKey&&!n.ctrlKey){if(this.home()){n.stop()}}else{if(m==35&&!n.shiftKey&&!n.ctrlKey){if(this.end()){n.stop()}}else{if(m==33&&!n.shiftKey&&!n.ctrlKey&&!gecko){if(this.pageUp()){n.stop()}}else{if(m==34&&!n.shiftKey&&!n.ctrlKey&&!gecko){if(this.pageDown()){n.stop()}}else{if((m==219||m==221)&&n.ctrlKey&&!n.altKey){this.highlightParens(n.shiftKey,true);n.stop()}else{if(n.metaKey&&!n.shiftKey&&(m==37||m==39)){var o=select.selectionTopNode(this.container);if(o===false||!this.container.firstChild){return}if(m==37){select.focusAfterNode(j(o),this.container)}else{var l=k(o,this.container);select.focusAfterNode(l?l.previousSibling:this.container.lastChild,this.container)}n.stop()}else{if((n.ctrlKey||n.metaKey)&&!n.altKey){if((n.shiftKey&&m==90)||m==89){select.scrollToNode(this.history.redo());n.stop()}else{if(m==90||(safari&&m==8)){select.scrollToNode(this.history.undo());n.stop()}else{if(m==83&&this.options.saveFunction){this.options.saveFunction();n.stop()}else{if(m==86){this.reroutePasteEvent()}}}}}}}}}}}}}}},keyPress:function(o){var l=this.options.electricChars&&f.Parser.electricChars,m=this;if((this.frozen&&(!this.keyFilter||this.keyFilter(o.keyCode||o.code,o)))||o.code==13||(o.code==9&&this.options.tabMode!="default")||(o.code==32&&o.shiftKey&&this.options.tabMode=="default")){o.stop();return false}else{if(l&&l.indexOf(o.character)!=-1){this.parent.setTimeout(function(){m.indentAtCursor(null)},0)}else{if(brokenOpera){if(o.code==8){var p=select.selectionTopNode(this.container),m=this,n=p?p.nextSibling:this.container.firstChild;if(p!==false&&n&&isBR(n)){this.parent.setTimeout(function(){if(select.selectionTopNode(m.container)==n){select.focusAfterNode(n.previousSibling,m.container)}},20)}}else{if(o.code==46){var p=select.selectionTopNode(this.container),m=this;if(p&&isBR(p)){this.parent.setTimeout(function(){if(select.selectionTopNode(m.container)!=p){select.focusAfterNode(p,m.container)}},20)}}}}}}},keyUp:function(l){this.cursorActivity(a(l.keyCode))},indentLineAfter:function(l,q){function u(x){var w=x?x.nextSibling:v.container.firstChild;if(!w||!hasClass(w,"whitespace")){return null}return w}var v=this,s=u(l);var m=0,t=s?s.currentText.length:0;if(q=="keep"){if(l){var r=u(j(l.previousSibling));if(r){m=r.currentText.length}}}else{var p=s?s.nextSibling:(l?l.nextSibling:this.container.firstChild);var o=(l&&p&&p.currentText)?p.currentText:"";if(q!=null&&this.options.tabMode=="shift"){m=q?t+indentUnit:Math.max(0,t-indentUnit)}else{if(l){m=l.indentation(o,t,q)}else{if(f.Parser.firstIndentation){m=f.Parser.firstIndentation(o,t,q)}}}}var n=m-t;if(n<0){if(m==0){if(p){select.snapshotMove(s.firstChild,p.firstChild||p,0)}removeElement(s);s=null}else{select.snapshotMove(s.firstChild,s.firstChild,n,true);s.currentText=makeWhiteSpace(m);s.firstChild.nodeValue=s.currentText}}else{if(n>0){if(s){s.currentText=makeWhiteSpace(m);s.firstChild.nodeValue=s.currentText;select.snapshotMove(s.firstChild,s.firstChild,n,true)}else{s=makePartSpan(makeWhiteSpace(m),this.doc);s.className="whitespace";if(l){insertAfter(s,l)}else{this.container.insertBefore(s,this.container.firstChild)}select.snapshotMove(p&&(p.firstChild||p),s.firstChild,m,false,true)}}else{if(s){select.snapshotMove(s.firstChild,s.firstChild,m,false)}}}if(n!=0){this.addDirtyNode(l)}},highlightAtCursor:function(){var m=select.selectionTopNode(this.container,true);var l=select.selectionTopNode(this.container,false);if(m===false||l===false){return false}select.markSelection(this.win);if(this.highlight(m,k(l,this.container),true,20)===false){return false}select.selectMarked();return true},handleTab:function(l){if(this.options.tabMode=="spaces"){select.insertTabAtCursor(this.win)}else{this.reindentSelection(l)}},home:function(){var m=select.selectionTopNode(this.container,true),n=m;if(m===false||!(!m||m.isPart||isBR(m))||!this.container.firstChild){return false}while(m&&!isBR(m)){m=m.previousSibling}var l=m?m.nextSibling:this.container.firstChild;if(l&&l!=n&&l.isPart&&hasClass(l,"whitespace")){select.focusAfterNode(l,this.container)}else{select.focusAfterNode(m,this.container)}select.scrollToCursor(this.container);return true},end:function(){var l=select.selectionTopNode(this.container,true);if(l===false){return false}l=k(l,this.container);if(!l){return false}select.focusAfterNode(l.previousSibling,this.container);select.scrollToCursor(this.container);return true},pageUp:function(){var l=this.cursorPosition().line,n=this.visibleLineCount();if(l===false||n===false){return false}n-=2;for(var m=0;m<n;m++){l=this.prevLine(l);if(l===false){break}}if(m==0){return false}select.setCursorPos(this.container,{node:l,offset:0});select.scrollToCursor(this.container);return true},pageDown:function(){var l=this.cursorPosition().line,o=this.visibleLineCount();if(l===false||o===false){return false}o-=2;for(var m=0;m<o;m++){var n=this.nextLine(l);if(n===false){break}l=n}if(m==0){return false}select.setCursorPos(this.container,{node:l,offset:0});select.scrollToCursor(this.container);return true},scheduleParenHighlight:function(){if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}var l=this;this.parenEvent=this.parent.setTimeout(function(){l.highlightParens()},300)},highlightParens:function(y,m){var w=this;function o(A,z){if(!A){return}if(w.options.markParen){w.options.markParen(A,z)}else{A.style.fontWeight="bold";A.style.color=z?"#8F8":"#F88"}}function t(z){if(!z){return}if(w.options.unmarkParen){w.options.unmarkParen(z)}else{z.style.fontWeight="";z.style.color=""}}if(!m&&w.highlighted){t(w.highlighted[0]);t(w.highlighted[1])}if(!window.select){return}if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}this.parenEvent=null;function u(A){if(A.currentText){var z=A.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return z&&z[1]}}function q(z){return/[\(\[\{]/.test(z)}var l,v=select.selectionTopNode(this.container,true);if(!v||!this.highlightAtCursor()){return}v=select.selectionTopNode(this.container,true);if(!(v&&((l=u(v))||(v=v.nextSibling)&&(l=u(v))))){return}var s=v.className,n=q(l),p=matching[l];function r(){var z=[],B,A=true;for(var C=v;C;C=n?C.nextSibling:C.previousSibling){if(C.className==s&&isSpan(C)&&(B=u(C))){if(q(B)==n){z.push(B)}else{if(!z.length){A=false}else{if(z.pop()!=matching[B]){A=false}}}if(!z.length){break}}else{if(C.dirty||!isSpan(C)&&!isBR(C)){return{node:C,status:"dirty"}}}}return{node:C,status:C&&A}}while(true){var x=r();if(x.status=="dirty"){this.highlight(x.node,k(x.node));x.node.dirty=false;continue}else{o(v,x.status);o(x.node,x.status);if(m){w.parent.setTimeout(function(){t(v);t(x.node)},500)}else{w.highlighted=[v,x.node]}if(y&&x.node){select.focusAfterNode(/[\(\[\{]/.test(x.node.currentText)?x.node:x.node.previousSibling,this.container)}break}}},indentAtCursor:function(l){if(!this.container.firstChild){return}if(!this.highlightAtCursor()){return}var m=select.selectionTopNode(this.container,false);if(m===false){return}select.markSelection(this.win);this.indentLineAfter(j(m),l);select.selectMarked()},indentRegion:function(q,l,p){var o=(q=j(q)),n=q&&j(q.previousSibling);if(!isBR(l)){l=k(l,this.container)}this.addDirtyNode(q);do{var m=k(o,this.container);if(o){this.highlight(n,m,true)}this.indentLineAfter(o,p);n=o;o=m}while(o!=l);select.setCursorPos(this.container,{node:q,offset:0},{node:l,offset:0})},cursorActivity:function(l){if(this.unloaded){this.win.document.designMode="off";this.win.document.designMode="on";this.unloaded=false}if(internetExplorer){this.container.createTextRange().execCommand("unlink");this.selectionSnapshot=select.getBookmark(this.container)}var m=this.options.cursorActivity;if(!l||m){var n=select.selectionTopNode(this.container,false);if(n===false||!this.container.firstChild){return}n=n||this.container.firstChild;if(m){m(n)}if(!l){this.scheduleHighlight();this.addDirtyNode(n)}}},reparseBuffer:function(){forEach(this.container.childNodes,function(l){l.dirty=true});if(this.container.firstChild){this.addDirtyNode(this.container.firstChild)}},addDirtyNode:function(m){m=m||this.container.firstChild;if(!m){return}for(var l=0;l<this.dirty.length;l++){if(this.dirty[l]==m){return}}if(m.nodeType!=3){m.dirty=true}this.dirty.push(m)},allClean:function(){return !this.dirty.length},scheduleHighlight:function(){var l=this;this.parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=this.parent.setTimeout(function(){l.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){while(this.dirty.length>0){var l=this.dirty.pop();try{while(l&&l.parentNode!=this.container){l=l.parentNode}if(l&&(l.dirty||l.nodeType==3)){return l}}catch(m){}}return null},highlightDirty:function(o){if(!window.select){return false}var n;if(!this.options.readOnly){select.markSelection(this.win)}var p,m=o?null:c()+this.options.passTime;while((c()<m||o)&&(p=this.getDirtyNode())){n=1;var l=this.highlight(p,m);if(l&&l.node&&l.dirty){this.addDirtyNode(l.node.nextSibling)}}if(!this.options.readOnly){select.selectMarked()}if(p){this.scheduleHighlight()}if(n&&this.options.onRendered){this.options.onRendered(this,!p)}return this.dirty.length==0},documentScanner:function(l){var m=this,n=null;return function(){if(!window.select){return}if(n&&n.parentNode!=m.container){n=null}select.markSelection(m.win);var o=m.highlight(n,c()+l,true);select.selectMarked();var p=o?(o.node&&o.node.nextSibling):null;n=(n==p)?null:p;m.delayScanning()}},delayScanning:function(){if(this.scanner){this.parent.clearTimeout(this.documentScan);this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning)}},highlight:function(A,E,C,w){var u=this.container,v=this,q=this.options.activeTokens;var o=(typeof E=="number"?E:null);if(!u.firstChild){return false}while(A&&(!A.parserFromHere||A.dirty)){if(w!=null&&isBR(A)&&(--w)<0){return false}A=A.previousSibling}if(A&&!A.nextSibling){return false}function r(G,F){return !F.reduced&&F.currentText==G.value&&F.className==G.style}function m(F,G){F.currentText=F.currentText.substring(G);F.reduced=true}function s(G){var F=makePartSpan(G.value,v.doc,G.type);F.className=G.style;return F}function B(G){if(G){var F=G.oldNextSibling;if(z||F===undefined||G.nextSibling!=F){v.history.touch(G)}G.oldNextSibling=G.nextSibling}else{var F=v.container.oldFirstChild;if(z||F===undefined||v.container.firstChild!=F){v.history.touch(null)}v.container.oldFirstChild=v.container.firstChild}}var n=e(A?A.nextSibling:u.firstChild),p=stringStream(n),t=A?A.parserFromHere(p):f.Parser.make(p);function x(F){return(F.previousSibling==null||isBR(F.previousSibling))&&(F.nextSibling==null||isBR(F.nextSibling))}var y={current:null,get:function(){if(!this.current){this.current=n.nodes.shift()}return this.current},next:function(){this.current=null},remove:function(){u.removeChild(this.get());this.current=null},getNonEmpty:function(){var G=this.get();while(G&&isSpan(G)&&G.currentText==""){if(window.opera&&x(G)){this.next();G=this.get()}else{var F=G;this.remove();G=this.get();select.snapshotMove(F.firstChild,G&&(G.firstChild||G),0)}}return G}};var z=false,D=true,l=0;forEach(t,function(H){var G=y.getNonEmpty();if(H.value=="\n"){if(!isBR(G)){throw"Parser out of sync. Expected BR."}if(G.dirty||!G.indentation){z=true}B(A);A=G;G.parserFromHere=t.copy();G.indentation=H.indentation;G.dirty=false;if(o==null&&G==E){throw StopIteration}if((o!=null&&c()>=o)||(!z&&!D&&l>1&&!C)){throw StopIteration}D=z;z=false;l=0;y.next()}else{if(!isSpan(G)){throw"Parser out of sync. Expected SPAN."}if(G.dirty){z=true}l++;if(r(H,G)){G.dirty=false;y.next()}else{z=true;var F=s(H);if(G){G.style.display=="none"}u.insertBefore(F,G);if(q){q(F,H,v)}var K=H.value.length;var J=0;while(K>0){G=y.get();var I=G.currentText.length;select.snapshotReplaceNode(G.firstChild,F.firstChild,K,J);if(I>K){m(G,K);K=0}else{K-=I;J+=I;y.remove()}}}}});B(A);return{node:y.getNonEmpty(),dirty:z}}};return f})();addEventHandler(window,window.opera?"DOMContentLoaded":"load",function(){if(window.frameElement){var a=window.frameElement.CodeMirror;var b=a.editor=new Editor(a.options);this.parent.setTimeout(method(a,"init"),0)}});function tokenizer(d,c){function b(e){return e!="\n"&&/^[\s\u00a0]*$/.test(e)}var a={state:c,take:function(e){if(typeof(e)=="string"){e={style:e,type:e}}e.content=(e.content||"")+d.get();if(!/[\n\S]$/.test(e.content)){d.nextWhile(b)}e.value=e.content+d.get();return e},next:function(){if(!d.more()){throw StopIteration}var e;if(d.equals("\n")){d.next();return this.take("whitespace")}if(d.applies(b)){e="whitespace"}else{while(!e){e=this.state(d,function(f){a.state=f})}}return this.take(e)}};return a}var XMLParser=Editor.Parser=(function(){var e={autoSelfClosers:{br:true,img:true,hr:true,link:true,input:true,meta:true,col:true,frame:true,base:true,area:true},doNotIndent:{pre:true,"!cdata":true}};var f={autoSelfClosers:{},doNotIndent:{"!cdata":true}};var d=e;var c=false;var b=(function(){function g(l,m){var k=l.next();if(k=="<"){if(l.equals("!")){l.next();if(l.equals("[")){if(l.lookAhead("[CDATA[",true)){m(h("xml-cdata","]]>"));return null}else{return"xml-text"}}else{if(l.lookAhead("--",true)){m(h("xml-comment","-->"));return null}else{return"xml-text"}}}else{if(l.equals("?")){l.next();l.nextWhileMatches(/[\w\._\-]/);m(h("xml-processing","?>"));return"xml-processing"}else{if(l.equals("/")){l.next()}m(j);return"xml-punctuation"}}}else{if(k=="&"){while(!l.endOfLine()){if(l.next()==";"){break}}return"xml-entity"}else{l.nextWhileMatches(/[^&<\n]/);return"xml-text"}}}function j(l,m){var k=l.next();if(k==">"){m(g);return"xml-punctuation"}else{if(/[?\/]/.test(k)&&l.equals(">")){l.next();m(g);return"xml-punctuation"}else{if(k=="="){return"xml-punctuation"}else{if(/[\'\"]/.test(k)){m(i(k));return null}else{l.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/);return"xml-name"}}}}}function i(k){return function(l,m){while(!l.endOfLine()){if(l.next()==k){m(j);break}}return"xml-attribute"}}function h(l,k){return function(m,n){while(!m.endOfLine()){if(m.lookAhead(k,true)){n(g);break}m.next()}return l}}return function(l,k){return tokenizer(l,k||g)}})();function a(C){var y=b(C),t;var z=[q];var p=0,B=0;var A=null,n=null;var w;function s(G){for(var H=G.length-1;H>=0;H--){z.push(G[H])}}function l(){s(arguments);w=true}function g(){s(arguments);w=false}function m(){t.style+=" xml-error"}function o(G){return function(H,I){if(I==G){l()}else{m();l(arguments.callee)}}}function r(H,I){var G=d.doNotIndent.hasOwnProperty(H)||(n&&n.noIndent);n={prev:n,name:H,indent:B,startOfLine:I,noIndent:G}}function E(){n=n.prev}function h(G){return function(H,J){var I=G;if(I&&I.noIndent){return J}if(c&&/<!\[CDATA\[/.test(H)){return 0}if(I&&/^<\//.test(H)){I=I.prev}while(I&&!I.startOfLine){I=I.prev}if(I){return I.indent+indentUnit}else{return 0}}}function q(){return g(j,q)}var k={"xml-text":true,"xml-entity":true,"xml-comment":true,"xml-processing":true};function j(G,H){if(H=="<"){l(F,v,i(p==1))}else{if(H=="</"){l(u,o(">"))}else{if(G=="xml-cdata"){if(!n||n.name!="!cdata"){r("!cdata")}if(/\]\]>$/.test(H)){E()}l()}else{if(k.hasOwnProperty(G)){l()}else{m();l()}}}}}function F(G,H){if(G=="xml-name"){A=H.toLowerCase();t.style="xml-tagname";l()}else{A=null;g()}}function u(G,H){if(G=="xml-name"){t.style="xml-tagname";if(n&&H.toLowerCase()==n.name){E()}else{m()}}l()}function i(G){return function(H,I){if(I=="/>"||(I==">"&&d.autoSelfClosers.hasOwnProperty(A))){l()}else{if(I==">"){r(A,G);l()}else{m();l(arguments.callee)}}}}function v(G){if(G=="xml-name"){t.style="xml-attname";l(x,v)}else{g()}}function x(G,H){if(H=="="){l(D)}else{if(H==">"||H=="/>"){g(i)}else{g()}}}function D(G){if(G=="xml-attribute"){l(D)}else{g()}}return{indentation:function(){return B},next:function(){t=y.next();if(t.style=="whitespace"&&p==0){B=t.value.length}else{p++}if(t.content=="\n"){B=p=0;t.indentation=h(n)}if(t.style=="whitespace"||t.type=="xml-comment"){return t}while(true){w=false;z.pop()(t.style,t.content);if(w){return t}}},copy:function(){var I=z.concat([]),H=y.state,G=n;var J=this;return function(K){z=I.concat([]);p=B=0;n=G;y=b(K,H);return J}}}}return{make:a,electricChars:"/",configure:function(g){if(g.useHTMLKludges!=null){d=g.useHTMLKludges?e:f}if(g.alignCDATA){c=g.alignCDATA}}}})();var CSSParser=Editor.Parser=(function(){var b=(function(){function g(i,j){var h=i.next();if(h=="@"){i.nextWhileMatches(/\w/);return"css-at"}else{if(h=="/"&&i.equals("*")){j(e);return null}else{if(h=="<"&&i.equals("!")){j(d);return null}else{if(h=="="){return"css-compare"}else{if(i.equals("=")&&(h=="~"||h=="|")){i.next();return"css-compare"}else{if(h=='"'||h=="'"){j(f(h));return null}else{if(h=="#"){i.nextWhileMatches(/\w/);return"css-hash"}else{if(h=="!"){i.nextWhileMatches(/[ \t]/);i.nextWhileMatches(/\w/);return"css-important"}else{if(/\d/.test(h)){i.nextWhileMatches(/[\w.%]/);return"css-unit"}else{if(/[,.+>*\/]/.test(h)){return"css-select-op"}else{if(/[;{}:\[\]]/.test(h)){return"css-punctuation"}else{i.nextWhileMatches(/[\w\\\-_]/);return"css-identifier"}}}}}}}}}}}}function e(j,k){var h=false;while(!j.endOfLine()){var i=j.next();if(h&&i=="/"){k(g);break}h=(i=="*")}return"css-comment"}function d(j,k){var i=0;while(!j.endOfLine()){var h=j.next();if(i>=2&&h==">"){k(g);break}i=(h=="-")?i+1:0}return"css-comment"}function f(h){return function(j,l){var k=false;while(!j.endOfLine()){var i=j.next();if(i==h&&!k){break}k=!k&&i=="\\"}if(!k){l(g)}return"css-string"}}return function(i,h){return tokenizer(i,h||g)}})();function c(e,d,f){return function(g){if(!e||/^\}/.test(g)){return f}else{if(d){return f+indentUnit*2}else{return f+indentUnit}}}}function a(i,h){h=h||0;var j=b(i);var f=false,e=false,g=false;var d={next:function(){var k=j.next(),l=k.style,m=k.content;if(l=="css-hash"){l=k.style=e?"css-colorcode":"css-identifier"}if(l=="css-identifier"){if(e){k.style="css-value"}else{if(!f&&!g){k.style="css-selector"}}}if(m=="\n"){k.indentation=c(f,e,h)}if(m=="{"){f=true}else{if(m=="}"){f=e=g=false}else{if(m==";"){e=g=false}else{if(f&&l!="css-comment"&&l!="whitespace"){e=true}else{if(!f&&l=="css-at"){g=true}}}}}return k},copy:function(){var l=f,m=e,k=j.state;return function(n){j=b(n,k);f=l;e=m;return d}}};return d}return{make:a,electricChars:"}"}})();var tokenizeJavaScript=(function(){function a(j,h){var k=false;while(!j.endOfLine()){var i=j.next();if(i==h&&!k){return false}k=!k&&i=="\\"}return k}var b=function(){function h(p,o){return{type:p,style:"js-"+o}}var n=h("keyword a","keyword");var m=h("keyword b","keyword");var l=h("keyword c","keyword");var i=h("operator","keyword");var k=h("atom","keyword");var j=h("variable","linbglobal");return{"if":n,"while":n,"with":n,"else":m,"do":m,"try":m,"finally":m,"return":l,"break":l,"continue":l,"new":l,"delete":l,"throw":l,"in":i,"typeof":i,"instanceof":i,"var":h("var","keyword"),"function":h("function","keyword"),"catch":h("catch","keyword"),"for":h("for","keyword"),"switch":h("switch","keyword"),"case":h("case","keyword"),"default":h("default","keyword"),"true":k,"false":k,"null":k,"undefined":k,"NaN":k,"Infinity":k,"void":k,"this":h("variable","keyword"),linb:j,_:j,Class:j,NameSpace:j}}();var d=/[+\-*&%=<>!?|]/;var g=/[0-9A-Fa-f]/;var e=/[\w\$_]/;function c(h,i){return function(l,n){var j=h;var k=f(h,i,l,function(o){j=o});var m=k.type=="operator"||k.type=="keyword c"||k.type.match(/^[\[{}\(,;:]$/);if(m!=i||j!=h){n(c(j,m))}return k}}function f(m,n,i,j){function l(){i.next();i.nextWhileMatches(g);return{type:"number",style:"js-atom"}}function q(){i.nextWhileMatches(/[0-9]/);if(i.equals(".")){i.next();i.nextWhileMatches(/[0-9]/)}if(i.equals("e")||i.equals("E")){i.next();if(i.equals("-")){i.next()}i.nextWhileMatches(/[0-9]/)}return{type:"number",style:"js-atom"}}function p(){i.nextWhileMatches(e);var u=i.get();var t=b.hasOwnProperty(u)&&b.propertyIsEnumerable(u)&&b[u];return t?{type:t.type,style:t.style,content:u}:{type:"variable",style:"js-variable",content:u}}function k(){a(i,"/");i.nextWhileMatches(/[img]/);return{type:"regexp",style:"js-regexp"}}function r(w){var u="/*";var t=(w=="*");while(true){if(i.endOfLine()){break}var v=i.next();if(v=="/"&&t){u=null;break}t=(v=="*")}j(u);return{type:"comment",style:"js-comment"}}function o(){i.nextWhileMatches(d);return{type:"operator",style:"js-operator"}}function s(t){var u=a(i,t);j(u?t:null);return{type:"string",style:"js-string"}}if(m=='"'||m=="'"){return s(m)}var h=i.next();if(m=="/*"){return r(h)}else{if(h=='"'||h=="'"){return s(h)}else{if(/[\[\]{}\(\),;\:\.]/.test(h)){return{type:h,style:"js-punctuation"}}else{if(h=="0"&&(i.equals("x")||i.equals("X"))){return l()}else{if(/[0-9]/.test(h)){return q()}else{if(h=="/"){if(i.equals("*")){i.next();return r(h)}else{if(i.equals("/")){a(i,null);return{type:"comment",style:"js-comment"}}else{if(n){return k()}else{return o()}}}}else{if(d.test(h)){return o()}else{return p()}}}}}}}}return function(i,h){return tokenizer(i,h||c(false,true))}})();var JSParser=Editor.Parser=(function(){var c={atom:true,number:true,variable:true,string:true,regexp:true};var b=false;function e(k,g,f,j,h,i){this.indented=k;this.column=g;this.type=f;if(j!=null){this.align=j}this.prev=h;this.info=i}function d(f){return function(h){var j=h&&h.charAt(0),i=f.type;var g=j==i;if(i=="vardef"){return f.indented+4}else{if(i=="form"&&j=="{"){return f.indented}else{if(i=="stat"||i=="form"){return f.indented+indentUnit}else{if(f.info=="switch"&&!g){return f.indented+(/^(?:case|default)\b/.test(h)?indentUnit:2*indentUnit)}else{if(f.align){return f.column-(g?1:0)}else{return f.indented+(g?0:indentUnit)}}}}}}}function a(h,K){var F=tokenizeJavaScript(h);var H=[b?T:o];var V={prev:null,vars:{"this":true}};var z=new e((K||0)-indentUnit,0,"block",false);var P=0;var q=0;var A,m;var w;var E={next:k,copy:U};function k(){while(H[H.length-1].lex){H.pop()()}var W=F.next();if(W.type=="whitespace"&&P==0){q=W.value.length}P+=W.value.length;if(W.content=="\n"){q=P=0;if(!("align" in z)){z.align=false}W.indentation=d(z);w=true}if(W.type=="whitespace"||W.type=="comment"){return W}if(!("align" in z)){z.align=true}while(true){A=m=false;H.pop()(W);if(A){if(m){W.style=m}else{if(W.type=="variable"&&B(W.content)){W.style="js-localvariable"}}return W}}}function U(){var Y=V,X=z,Z=H.concat([]),W=F.state;return function aa(ab){V=Y;z=X;H=Z.concat([]);P=q=0;F=tokenizeJavaScript(ab,W);return E}}function R(W){for(var X=W.length-1;X>=0;X--){H.push(W[X])}}function J(){R(arguments);A=true}function f(){R(arguments);A=false}function r(W){m=W}function y(){V={prev:V,vars:{"this":true,"arguments":true}}}function x(){V=V.prev}function s(W){if(V){r("js-variabledef");V.vars[W]=true}}function B(W){var X=V;while(X){if(X.vars[W]){return true}X=X.prev}return false}function p(X,Y){var W=function(){z=new e(q,P,X,null,z,Y)};W.lex=true;return W}function I(){z=z.prev}I.lex=true;function g(Y,Z,X){if(X){w=false}return function W(aa){if(Y&&aa.type==Y){J()}else{if(Z&&aa.type==Z){f()}else{if(X&&w){f()}else{J(arguments.callee)}}}}}function o(W){return f(D,o)}function T(W){return f(C,T)}function D(W){var X=W.type;if(X=="var"){J(p("vardef"),M,g(";","}",true),I)}else{if(X=="keyword a"){J(p("form"),C,D,I)}else{if(X=="keyword b"){J(p("form"),D,I)}else{if(X=="{"){J(p("}"),t,I)}else{if(X=="function"){J(n)}else{if(X=="for"){J(p("form"),g("("),p(")"),l,g(")"),I,D,I)}else{if(X=="variable"){J(p("stat"),G)}else{if(X=="switch"){J(p("form"),C,p("}","switch"),g("{"),t,I,I)}else{if(X=="case"){J(C,g(":"))}else{if(X=="default"){J(g(":"))}else{if(X=="catch"){J(p("form"),y,g("("),v,g(")"),D,I,x)}else{if(X=="}"){f(p("stat"),C,g(";"),I)}else{f(p("stat"),C,g(";","}",true),I)}}}}}}}}}}}}}function C(W){var X=W.type;if(c.hasOwnProperty(X)){J(O)}else{if(X=="function"){J(n)}else{if(X=="keyword c"){J(C)}else{if(X=="("){J(p(")"),C,g(")"),I,O)}else{if(X=="operator"){J(C)}else{if(X=="["){J(p("]"),Q(C,"]"),I,O)}else{if(X=="{"){J(p("}"),Q(u,"}"),I,O)}}}}}}}}function O(W){var X=W.type;if(X=="operator"){if(W.content=="?"){J(C,g(":"),C)}else{J(C)}}else{if(X=="("){J(p(")"),Q(C,")"),I,O)}else{if(X=="."){J(S,O)}else{if(X=="["){J(p("]"),C,g("]"),I,O)}}}}}function G(W){if(W.type==":"){J(I,D)}else{f(O,g(";","}",true),I)}}function S(W){if(W.type=="variable"){r("js-property");J()}}function u(W){if(W.type=="variable"){r("js-property")}if(c.hasOwnProperty(W.type)){J(g(":"),C)}}function Q(Y,W){function X(aa){if(aa.type==","){J(Y,X)}else{if(aa.type==W){J()}else{J(g(W))}}}return function Z(aa){if(aa.type==W){J()}else{f(Y,X)}}}function t(W){if(W.type=="}"){J()}else{f(D,t)}}function M(W){if(W.type=="variable"){s(W.content);J(L)}else{J()}}function L(W){if(W.content=="="){J(C,L)}else{if(W.type==","){J(M)}}}function l(W){var X=W.type;if(X=="var"){J(M,j)}else{if(X==";"){f(j)}else{if(X=="variable"){J(N)}else{f(j)}}}}function N(W){if(W.type=="in"){J(D)}else{if(W.type==";"){f(j)}else{if(W.content=="="){J(C,j)}else{J(O,C)}}}}function j(W){if(W.type==";"){J(i)}else{if(W.content=="in"){J(C)}else{if(W.content=="="){J(D,i)}else{J(C,g(";"),i)}}}}function i(W){if(W.type==")"){f()}else{J(C)}}function n(W){if(W.type=="variable"){s(W.content);J(n)}else{if(W.type=="("){J(y,Q(v,")"),D,x)}}}function v(W){if(W.type=="variable"){s(W.content);J()}}return E}return{make:a,electricChars:"{}:",scopeChars:"{}",configure:function(f){if(f.json!=null){b=f.json}}}})();var HTMLMixedParser=Editor.Parser=(function(){if(!(CSSParser&&JSParser&&XMLParser)){throw new Error("CSS, JS, and XML parsers must be loaded for HTML mixed mode to work.")}XMLParser.configure({useHTMLKludges:true});function a(f){var d=XMLParser.make(f),i=null,h=false;var b={next:e,copy:g};function e(){var j=d.next();if(j.content=="<"){h=true}else{if(j.style=="xml-tagname"&&h===true){h=j.content.toLowerCase()}else{if(j.content==">"){if(h=="script"){b.next=c(JSParser,"<\/script")}else{if(h=="style"){b.next=c(CSSParser,"</style")}}h=false}}}return j}function c(l,j){var k=d.indentation();i=l.make(f,k+indentUnit);return function(){if(f.lookAhead(j,false,false,true)){i=null;b.next=e;return e()}var n=i.next();var m=n.value.lastIndexOf("<"),o=Math.min(n.value.length-m,j.length);if(m!=-1&&n.value.slice(m,m+o).toLowerCase()==j.slice(0,o)&&f.lookAhead(j.slice(o),false,false,true)){f.push(n.value.slice(m));n.value=n.value.slice(0,m)}if(n.indentation){var p=n.indentation;n.indentation=function(q){if(q=="</"){return k}else{return p(q)}}}return n}}function g(){var j=d.copy(),m=i&&i.copy(),k=b.next,l=h;return function(n){f=n;d=j(n);i=m&&m(n);b.next=k;h=l;return b}}return b}return{make:a,electricChars:"{}/:"}})();